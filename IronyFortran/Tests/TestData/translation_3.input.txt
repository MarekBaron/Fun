CHARACTER(256) FUNCTION MakeOrderNumber(OrderNr, sRecType, iTgaNr, iVarID, iParentID, bCorrect);
CHARACTER(70) OrderNr, NewOrderNr;
CHARACTER(6) sRecType;
INTEGER iTgaNr(1:18), iVarID, iParentID, iBH(8),iBHEnd;
INTEGER iIdx, iPos;
LOGICAL bOK, bFound, bUseParent, bContinue, bIsTrue_1, bIsTrue_2, bCorrect;
INTEGER iStartPos, iLen, iPoint, iLenBody;
CHARACTER(256) sHead, sBody, sTail;
iBHEnd=4;
iBH(1:iBHEnd)   =(/726,1144,1486,1790/);
NewOrderNr=OrderNr;
bCorrect=.TRUE.;
bUseParent=(iParentID > 0);
IF (bUseParent) THEN;
bFound=FindPointer('BA,SE', iTgaNr(16), iTgaNr(iParentID), iPoint);
ELSE;
bFound=FindPointer(sRecType, iTgaNr(16), 0, iPoint);
ENDIF;
IF (bFound) THEN;
iStartPos=VDIIWERT('700', iTgaNr(16), '710.05', iPoint, 5);
iLen=VDIIWERT('700', iTgaNr(16), '710.05', iPoint, 6);
bIsTrue_1=((iStartPos > 0) .AND. (iLen > 0));
IF (bIsTrue_1) THEN;
bIsTrue_2=(iStartPos==1);
IF (bIsTrue_2) THEN;
sHead='';
ELSE;
sHead=VDICSTRING(OrderNr, 0, 1, (iStartPos - 1));
ENDIF;
sTail=VDICSTRING(OrderNr, 0, (iStartPos + iLen), 0);
bOK=.FALSE.;
IF (bUseParent) THEN;
iPos=6;
ELSE;
iPos=5;
ENDIF;
iIdx=1;
bContinue=.TRUE.;
DO WHILE (bContinue);
iPos=iPos + 2;
iIdx=VDIIWERT('700', iTgaNr(16), '710.05', iPoint, iPos);
bIsTrue_2=((iIdx == iTgaNr(iVarID)) .OR. (iTgaNr(iVarID) < 0));
IF (bIsTrue_2) THEN;
sBody=VDICWERT('700', iTgaNr(16), '710.05', iPoint, (iPos + 1), iLenBody);
iTgaNr(iVarID)=iIdx;
bOK=(iLenBody > 0);
ENDIF;
bContinue=((.NOT. bOK) .AND. (iIdx > 0));
ENDDO;
IF (bOK) THEN;
NewOrderNr=VDISTRING('&|&|&', sHead, sBody, sTail);
ELSE;
bCorrect=.FALSE.;
ENDIF;
ENDIF;
ENDIF;
MakeOrderNumber=NewOrderNr;
END FUNCTION MakeOrderNumber;